👏 Gromacs|gmx pdb2gmx

---
[TOC]

---
## 简介
将PDB坐标文件转换为拓扑文件和力场兼容的坐标文件。

## 格式
```text
gmx pdb2gmx [-f [<.gro/.g96/...>]] [-o [<.gro/.g96/...>]] [-p [<.top>]]
    [-i [<.itp>]] [-n [<.ndx>]] [-q [<.gro/.g96/...>]] [-nice ]
    [-chainsep ] [-merge ] [-ff ] [-water ]
    [-[no]inter] [-[no]ss] [-[no]ter] [-[no]lys] [-[no]arg]
    [-[no]asp] [-[no]glu] [-[no]gln] [-[no]his] [-angle ]
    [-dist ] [-[no]una] [-[no]ignh] [-[no]missing] [-[no]v]
    [-posrefc ] [-vsite ] [-[no]heavyh] [-[no]deuterate]
    [-[no]chargegrp] [-[no]cmap] [-[no]renum] [-[no]rtpres]
```

## 参数
**输入/输出文件选项**
|参数|默认值|类型|说明|
|:----|:----|:----|:----|
|-f [<.gro/.g96/...>]|eiwit.pdb|输入|结构文件: gro g96 pdb brk ent esp tpr tpb tpa|
|-o [<.gro/.g96/...>]|conf.gro|输出|结构文件: gro g96 pdb brk ent esp|
|-p [<.top>]|topol.top|输出|拓扑文件|
|-i [<.itp>]|posre.itp|输出|拓扑文件中包含的文件|
|-n [<.ndx>]|clean.ndx|输出, 可选|索引文件|
|-q [<.gro/.g96/...>]|clean.pdb|输出, 可选|结构文件: gro g96 pdb brk ent esp|

**控制选项**
|参数|默认值|说明|
|:----|:----|:----|
|-nice \<int>|0|设置优先级。|
|-chainsep \<enum>|id_or_ter|设置通过何种方式判断一个新链开始，可用选项: id_or_ter，id_and_ter，ter，id，interactive。|
|-merge \<enum>|no|设置是否将多条链合并为单个[ moleculetype ]，可用选项: no，all，interactive。|
|-ff \<string>|select|设置使用何种力场，默认交互式地选择。使用-h查看更多信息。|
|-water \<enum>|select|设置使用的水分子模型，可用选项: select，none，spc，spce，tip3p，tip4p，tip5p。使用这个参数会提前在拓扑文件中添加水分子信息。|
|-[no]inter|no|如果开启了这个选项, 接下来的八个选项就会交互式地让用户选择|
|-[no]ss|no|交互式地选择二硫键|
|-[no]ter|no|交互式地选择蛋白末端，默认带电|
|-[no]lys|no|交互式地选择lys赖氨酸类型，默认带电|
|-[no]arg|no|交互式地选择arg精氨酸类型，默认带电|
|-[no]asp|no|交互式地选择asp天冬氨酸类型，默认带电|
|-[no]glu|no|交互式地选择glu谷氨酸类型，默认带电|
|-[no]gln|no|交互式地选择gln谷氨酰胺类型，默认中性|
|-[no]his|no|交互式地选择his组胺酸类型，默认通过检查氢键判断|
|-angle \<real>|135|设置氢键中氢-氢供体-氢受体之间的最小角度，单位度|
|-dist \<real>|0.3|设置氢键中氢供体-氢受体之间的最大距离，单位nm|
|-[no]una|no|将苯丙氨酸，色氨酸，酪氨酸中的芳香环设为联合CH原子。|
|-[no]ignh|no|忽略坐标文件中的氢原子。因为氢原子的命名规则不统一，有些力场无法识别。|
|-[no]missing|no|当发现坐标文件中的原子有缺失时继续运行，设置这个选项很危险。|
|-[no]v|no|在屏幕上输出更多的信息|
|-posrefc \<real>|1000|位置限制的力常数。|
|-vsite \<enum>|none|设置将哪些原子转变为虚拟位点，可用选项： none，hydrogens，aromatics。|
|-[no]heavyh|no|将氢原子质量增大一些。|
|-[no]deuterate|no|将氢原子质量更改为2 amu。|
|-[no]chargegrp|yes|使用.rtp文件中的电荷组。|
|-[no]cmap|yes|使用cmap中的扭转(如果在.rtp文件开启)。|
|-[no]renum|no|对输出中的残基重新编号以保证编号连续。|
|-[no]rtpres|no|使用.rtp中的条目名称作为残基名称。|

## 常规使用方法
（1）**gmx pdb2gmx**读取一个**pdb**(或**gro**)文件和一些数据库文件，**为分子添加氢原子**，生成GROMACS(GROMOS)格式或可选的**pdb**格式的坐标文件，并**生成一个GROMACS格式的拓扑文件**。对这些文件进行后续处理即可生成运行模拟需要的运行输入文件。

（2）**gmx pdb2gmx搜索力场**时，会在当前工作目录和GROMACS库目录下的\<forcefield>.ff子目录中搜寻forcefiled.itp文件，**库目录根据可执行文件的路径确定或由环境变量GMXLIB指定**。默认情况下，当程序找到所有可用的forcefield.itp文件后，会提示你选择其中的一个力场。但你也可以在命令行中**使用-ff选项指定列表中某一力场的简短名称**。在这种情况下，gmx pdb2gmx程序只会搜寻对应的\<forcefield>.ff目录。

（3）当选择了一种力场后，程序仅会读取对应力场目录下的所有文件。如果要修改或添加一个残基类型，你可以把整个力场目录复制到你的当前工作目录。**如果想增加一个新的蛋白质残基类型，你需要修改库目录下的residuetype.dat文件，或将整个库目录复制到本地的一个目录中，修改复制后的residuetype.dat文件，并将环境变量GMXLIB设为新的目录。**

（4）**pdb文件只是一种文件类型。只要GROMACS数据库支持，任何类型分子都可以使用gmx pdb2gmx进行转换。如果数据库不支持，可以自己添加。**

（5）该程序本身也不是万能的，它需要读取一系列的数据库文件，这样才能在残基之间加上特殊的化学键(如Cys-Cys, Heme-His等等)。如果你觉得有必要，这些都可以手动完成。当指定一些选项后，程序可以提示用户选择蛋白质中的LYS、ASP、GLU、CYS或HIS残基的质子化状态。**对于Lys来说，可以选择中性(即NZ上有两个质子)，也可以选择质子化的(3个质子，默认)。对于Asp和Glu可以选择非质子化的(默认)或质子化的。对于His，质子可以位于ND1或NE2或前两者之上。默认情况下，这些选择会自动完成。** 对于His，是根据最优的氢键构象来进行选择的。氢键是根据简单的几何准则来定义的，由分子构型确定。对要判断的三个原子，即氢供体，氢原子，氢受体，若氢-供体-受体三者之间的角度小于最大角度值，并且供体-受体原子之间的距离小于最大距离值，则认为三个原子之间存在氢键。最大氢键角度和最大氢键距离分别由-angle和-dist选项指定。

（6）如果使用了-ter选项，蛋白质N端和C端的质子化状态可以交互式选择。**默认情况下蛋白质的两端是离子化的(即NH3+和COO-)。** 对于只有一种残基的蛋白质链，有些力场可以把它设定为两性分子形式，但对于多肽链，不应该使用这些选项。AMBER力场对于蛋白质两端的残基有着自己的独特形式，与-ter选项不兼容。如果要使用AMBER力场，你需要在N或C端残基对应的名称前分别加上N或C，并保证坐标文件的格式相同。作为替代方法，你也可以使用专门的末端残基的名称(如ACE，NME)。

（7）处理PDB文件时，把不同的链分开并不是一件简单的事，因为用户自己生成的PDB文件中链的组织方式不同，使用的标记也不同，有时你确实需要在PDB里面合并由TER标记隔开的两个部分，比如你需要使用二硫键或距离限制将两条蛋白链连接起来，或者你的蛋白质上吸附有HEMD基团。在这种情况下，多条链需要包含在同一个[ moleculetype ]定义中。为了处理这个问题，gmx pdb2gmx可以使用两个独立的选项。**首先，-chainsep选项允许你选择何时开始一个新的化学链，何时为链添加末端。这可以根据PDB文件中存在的TER记录，或链序号的改变，或前两个条件中的一个或两个进行。你也可以完全交互式地进行选择。另外一个选项是-merge，它控制添加(或不添加)所有化学末端后，如何将多条链合并成一条链。也可以关闭这个选项(不合并)，也可以让所有不含水分子的链都合并到一个分子中，或交互式的选择。**

（8）**gmx pdb2gmx还会检查.pdb文件中的原子占有率，如果一个原子的占有率不是1，说明它在结构中的位置还没有很好的确定，这时pdb2gmx会给出警告信息。** 若一个.pdb文件不是来自X射线晶体衍射确定的结构，可能所有的占有率都是0。不管如何，当使用pdb2gmx时，你必须先验证输入PDB文件的正确性(读PDB文件作者的原始文章!)。

（9）处理时，文件中的原子会使用GROMACS约定进行记录。如果指定了-n选项，程序会生成一个索引文件，里面包含了以相同方式记录的一个原子组。这样你就可以用将GROMOS轨迹和坐标文件转换为GROMOS。需要注意的是，有一个限制，因为记录是在去除输入文件中的氢原子之后，添加新的氢原子之前生成的，所以你不应该再使用-ignh选项。

（10）.gro和.g96文件类型不支持识别链的序号，所以如果你要转换一个含有多条链的.pdb文件，最好使用-o选项将结果输出为.pdb格式的文件。

（11）**-vsite选项可以去除氢原子运动和快速的不当二面角运动。** 通过将氢原子转换为虚拟位点并固定键角，即固定它们相对于临近原子的位置，可以去除键角运动以及面外运动。此外，标准氨基酸中芳香环上的所有原子(即PHE、TRP、TYR和HIS)都可以转换为虚拟位点，从而去除这些环中的快速不当二面角运动。注意，在这种情况下，所有其他氢原子也会被转换为虚拟位点。所有被转换为虚拟位点的原子的质量会增加到重原子上。

（12）另外，你也可以**指定-heavyh选项，这样氢原子的质量会增加为原来的4倍，从而可以减慢二面角的运动。** 这种方法也可以用于水分子的氢原子，以减慢水分子的转动。应当从键合(重)原子的质量中减去氢原子增加的质量，以维持体系的总质量不变。

## 源码位置及解析
gromacs-2022.2/src/gromacs/gmxpreprocess/pdb2gmx.cpp

## 示例
（1）在使用Amber14sb和Charmm36力场建立RNA的gro文件时由于P、P1O和P2O导致碱基不在top的模板中，此时需要注意使用-ter选项。
```shell
gmx pdb2gmx -f *.pdb -o complex.gro -water tip3p -ignh -ter
# 10 0 0 5 4
```
（2）当最初建模使用的是tleap建模，跑完之后取其中一帧再次进行建模时候要记得将文件中的G5和A3改为G 和A ，不然pdb2gmx无法识别会报错。

(3) -ignh选项会将原本pdb中的氢去掉，然后以选定力场自己的规则进行再次加氢。（这里不同的力场不一样，用14sb力场会自动加氢，但是用gromos43a1.ff不会自动加氢）