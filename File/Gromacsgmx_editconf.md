👏 Gromacs|gmx editconf

---
[TOC]

---
## 简介
主要功能是对体系结构进行编辑，也可以将通用结构格式保存或转换为.gro、.g96或.pdb等其他格式。分子动力学模拟中，通常会给体系添加一个周期性的模拟盒子。**gmx editconf** 有许多控制盒子的选项。

## 格式
```text
gmx editconf [-f [<.gro/.g96/...>]] [-n [<.ndx>]] [-o [<.gro/.g96/...>]]
    [-mead [<.pqr>]] [-bf [<.dat>]] [-nice ] [-[no]w]
    [-[no]ndef] [-bt ] [-box ] [-angles ]
    [-d ] [-[no]c] [-center ] [-aligncenter ]
    [-align ] [-translate ] [-rotate ]
    [-[no]princ] [-scale ] [-density ] [-[no]pbc]
    [-resnr ] [-[no]grasp] [-rvdw ] [-[no]sig56]
    [-[no]vdwread] [-[no]atom] [-[no]legend] [-label ]
    [-[no]conect]
```

## 参数
**输入/输出文件选项**
|参数|默认值|类型|说明|
|:----|:----|:----|:----|
|-f [<.gro/.g96/...>]|conf.gro|输入|结构文件: gro g96 pdb brk ent esp tpr tpb tpa|
|-n [<.ndx>]|index.ndx|输入，可选|索引文件|
|-o [<.gro/.g96/...>]|out.gro|输出，可选|结构文件: gro g96 pdb brk ent esp。放进盒子里面的分子坐标文件。|
|-mead [<.pqr>]|mead.pqr|输出，可选|用于MEAD的坐标文件。|
|-bf [<.dat>]|bfact.dat|输入，可选|通用数据文件。|

**控制选项**
|参数|默认值|说明|
|:----|:----|:----|
|-nice \<int>|0|设置优先级。|
|-[no]w|no|程序结束自动打开输出的.xvg、.xpm、.eps和.pdb文件。|
|-[no]ndef|no|从默认索引组选择输出。|
|-bt \<enum>|triclinic|用于-box和-d的盒子类型: triclinic、cubic、dodecahedron、octahedron。|
|-box \<vector>|0 0 0|盒向量长度 (a,b,c)。即自定义的盒子大小。|
|-angles \<vector>|90 90 90|盒向量之间的角度 (bc,ac,ab)。|
|-d \<real>|0|溶质分子与盒子之间的距离。|
|-[no]c|no|使分子在盒子内居中(-box和-d选项暗含此选项)。|
|-center \<vector>|0 0 0|几何中心的坐标。|
|-aligncenter \<vector>|0 0 0|平齐的旋转中心。|
|-align \<vector>|0 0 0|与目标向量平齐。|
|-translate \<vector>|0 0 0|平移。|
|-rotate \<vector>|0 0 0|绕X，Y和Z轴的旋转角度，单位为度。|
|-[no]princ|no|使分子取向沿其主轴。|
|-scale \<vector>|1 1 1|缩放因子。|
|-density \<real>|1000|通过缩放使输出盒子的密度(g/L)为指定值。|
|-[no]pbc|no|移除周期性(使分子保持完整)。|
|-resnr \<int>|-1|从resnr开始重新对残基进行编号。|
|-[no]grasp|no|在B因子段存储原子电荷，在占有率段存储原子半径。|
|-rvdw \<real>|0.12|如果在数据库中找不到范德华半径或者拓扑文件中不存在参数，将使用默认的范德华半径(单位nm)。可用于处理缺少力场参数的原子。|
|-[no]sig56|no|使用rmin/2(范德华势能的最小点对应距离的一半)而不是σ/2(范德华半径的一半)。|
|-[no]vdwread|no|从vdwradii.dat文件中读取范德华半径，而不是根据力场计算半径。|
|-[no]atom|no|强制为每个原子附加B因子。|
|-[no]legend|no|创建B因子图例。|
|-label \<string>|A|为所有残基添加链标识符，以便指定其肽链归属。|
|-[no]conect|no|当写入的时候将CONECT记录添加到.pdb文件中。只有当拓扑文件存在时才可以。|

## 常规使用方法
（1）利用选项-box、-d和-angles可以对盒子进行修改。除非明确使用了-noc选项，**-box和-d都可以使体系在盒子内居中。**

（2）**选项-bt设定盒子类型：** triclinic为三斜盒子，cubic为所有边长都相等的长方体盒子(即立方体盒子)，dodecahedron代表菱形十二面体盒子(等边十二面体)，octahedron为截角八面体盒子(即将两个底面重合的四面体切去方向相反的两头，同时保证所有的边长相等)。后面两种盒子是三斜盒子的特殊情况。截角八面体三个盒向量的长度是两个相对六边形之间的最短距离。相对于具有周期性映象距离的立方盒子，具有相同周期距离的菱形十二面体盒子的体积是立方盒子的71%，而截角八面体盒子的体积是立方盒子的77%。

（3）对一般的三斜盒子，-box的参数是三个实数，为长方体的边长。对于立方盒子，菱形十二面体盒子或者截面八面体盒子，选项-box只需要提供一个数值，即盒子边长。

（4）**-d选项指定体系中的原子到盒子编边界的最小距离。** 使用-d选项时，对三斜盒子会使用体系在x，y和z方向的大小，对立方盒子，菱形十二面体盒子或截角八面体盒子，盒子的大小被设定为体系直径(原子间的最大距离)加上两倍的指定距离。

（5）**选项-angles只能与选项-box和三斜盒子一起使用才有意义，而且不能和选项-d一起使用。**

（6）当使用-n或-ndef时，可以指定一个索引文件，并选择其中的一个组来计算大小和几何中， 否则会使用整个体系的大小和几何中心。

（7）**-rotate选项可以对坐标和速度进行旋转。** 如-rotate 0 30 0表示将体系绕Y轴沿顺时针方向旋转30度。

（8）**-princ选项将体系(或体系某一部分)的主轴与坐标轴平齐，并且最长的轴沿x轴方向。** 这可以减小盒子的体积，特别当分子为长条形时。但是注意分子在纳秒的时间尺度内可能发生明显的旋转，所以使用时要小心。

（9）缩放会在任何其他操作之前进行。可以对盒子和坐标进行缩放以得到一定的密度(选项-density)。注意如果输入是.gro文件的话，密度可能不够精确。-scale选项的一个特性是，当某一维度的缩放因子为-1时，可以得到体系相对于一个平面的镜面映象。当三个维度的缩放因子都是-1时，可以获得体系相对于坐标原点的对称映象。

（10）组的选择是在其他所有操作都完成之后进行的。在程序输出时，可以只输出体系中的某一个组，或者某一个部分，还可以建立划分更细致的索引文件，以便进行更加细致的选择。

（11）可以粗略地去除体系的周期性。当去除周期性时，输入文件最底部的盒向量必须保证正确，这非常重要，因为gmx editconf去除周期性的算法十分简单，只是将原子坐标直接减去盒子边长。

（12）当输出.pdb文件时，可以使用-bf选项添加B因子。B因子可以从文件中读取，格式如下：第一行声明文件中所含B因子数值的个数，从第二行开始，每行声明一个索引号，后面跟着B因子。默认情况下，B因子将附加到每个残基上，每个残基一个数值，除非索引大于残基数目或者设定了-atom选项。显然，可以添加任何类型的数值数据而不仅仅是B因子。-legend选项将生成一列CA原子，其B因子的范围为所用数据的最小值到最大值，可以有效地作为查看的图例，便于可视化软件显示。

（13）**使用-mead选项时可以生成一个特殊的.pdb文件(.pqr)，它可用于MEAD静电程序(泊松玻尔兹曼方程求解器)。** 使用这个选项的前提条件是输入文件必须为运行输入文件(如tpr)，因为这样的文件中才包含了力场参数。输出文件中的B因子段为原子的范德华半径而占有率段为原子的电荷。

（14）-grasp选项的作用与上一选项类似，只不过互换了电荷与半径的位置，电荷位于B因子段，而半径位于占有率段。

（15）**选项-align可以将特定组的主轴与给定的向量平齐，-aligncenter选项指定可选的旋转中心。**

（16）最后，使用选项-label，gmx editconf可以为.pdb文件添加一个链标识符。如果一个文件中不同残基属于不同肽链，那么这个选项可以为残基指定肽链归属，这样不但有利于可视化，在使用一些程序如Rasmol进行分析时也很有帮助，在建立模拟体系时也十分方便。

（17）对一些软件包(如GROMOS)，会使用对立方盒子进行角截断的方法生成截角八面体，为转换这种截角八面体文件，可使用以下命令，其中veclen是立方盒子大小乘以$\frac{\sqrt{3}}{2}$。
```shell
gmx editconf -f in -rotate 0 45 35.264 -bt o -box veclen -o out
```

## 源码位置及解析
gromacs-2022.2/src/gromacs/gmxpreprocess/editconf.cpp

## 示例
（1）将gro文件去水去离子居中保存为pdb文件。
```shell
echo 22|gmx_mpi editconf -f prod.gro -c -o prod.pdb -n index.ndx
```